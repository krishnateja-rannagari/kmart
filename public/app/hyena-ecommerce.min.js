var commerceApp=angular.module("commerceApp",["ngRoute","ngResource","ngCart"]);commerceApp.config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"app/pages/home.html",controller:"mainController"}).when("/login",{templateUrl:"app/pages/login.html",controller:"mainController"}).when("/register",{templateUrl:"app/pages/register.html",controller:"mainController"}).when("/register-taken",{templateUrl:"app/pages/register.html",controller:"mainController",tellUser:"That username is already taken"}).when("/profile",{templateUrl:"app/pages/profile.html",controller:"profileController"}).when("/cart",{templateUrl:"app/pages/cart.html",controller:"productController"}).when("/details/:id",{templateUrl:"app/pages/details.html",controller:"detailsController"}).when("/:all*",{templateUrl:"app/pages/home.html",controller:"mainController"})}]),commerceApp.service("shareService",["$location","$http","$log",function(t,e,o){this.didLogout=!1,this.items,this.totalShipping,this.carttax,this.cat,this.currentItem,this.subcat,this.toProfile=function(){t.path("/profile")},this.toLogin=function(){t.path("/login")},this.toRegister=function(){t.path("/register")},this.details=function(e){t.path("/details/"+e._id)},this.toCart=function(){t.path("/cart")},this.goShopping=function(){t.path("/")},this.logout=function(){e.get("/logout"),t.path("/")}}]),commerceApp.controller("cartController",["$scope","$location","$http","$log","$route","ngCart","shareService",function(t,e,o,r,n,i,a){t.totalShipping=a.totalShipping,t.$watch("shareService.totalShipping",function(){t.totalShipping=a.totalShipping})}]),commerceApp.controller("checkoutController",["$scope","$location","$http","$log","$route","ngCart","shareService",function(t,e,o,r,n,i,a){t.items=a.items,t.carttax=a.carttax,t.$watch("shareService.items",function(){t.items=a.items}),t.$watch("shareService.carttax",function(){t.carttax=a.carttax})}]),commerceApp.controller("detailsController",["$scope","$location","$http","$log","$route","ngCart","shareService","$routeParams",function(t,e,o,r,n,i,a,c){t.department=a.cat,t.currentItem=c.id,t.details=a.details,t.toCart=a.toCart,t.goShopping=a.goShopping,t.getDetails=function(){o({method:"GET",url:"/products"}).then(function(e){t.products=e.data;for(var o=0;o<t.products.length;o++)t.products[o]._id==t.currentItem&&(t.thisProduct=t.products[o]);void 0===t.thisProduct&&r.error("unable to find match in product database. Please check url")},function(t){r.error("getDetails error : "+t)})},t.filterFunction=function(e){var o=!!e.department.match(a.cat),r=!!e._id.match(t.thisProduct._id);return o===!0&&r===!1},t.getDetails()}]),commerceApp.controller("headerController",["$scope","$location","$http","$log","$route","shareService",function(t,e,o,r,n,i){t.header=[{name:"header.html",url:"app/pages/header.html"}],t.header=t.header[0],t.shareService=i,t.toProfile=i.toProfile,t.toLogin=i.toLogin,t.toRegister=i.toRegister,t.logout=i.logout,t.displayLogin=!0,t.$watch("shareService.didLogout",function(e,o){e===!0&&(i.didLogout=!1,t.displayLogin=!0)}),t.localLogout=function(){t.logout(),t.displayLogin=!0},t.getUser=function(){o({method:"GET",url:"/user"}).then(function(e){t.user=e.data,""===t.user?t.displayLogin=!0:t.displayLogin=!1},function(e){r.error("/user error was : "+e),t.user="user error"})},t.getUser()}]),commerceApp.controller("mainController",["$scope","$location","$http","$log","$route","ngCart","shareService","$routeParams",function(t,e,o,r,n,i,a,c){n.current.tellUser&&(t.tellUser=n.current.tellUser),i.setTaxRate(7.5),i.setShipping(2.99),t.shareService=a,t.details=a.details,t.goShopping=a.goShopping,t.toCart=a.toCart,t.cartDetails=function(){var e=i.getItems();t.items=[],t.shippingTotal=0;for(var o=0;o<e.length;o++){var r=t.randomShipping().toFixed(2);t.shippingTotal=Number(t.shippingTotal)+Number(r);var n={name:e[o]._name,id:e[o]._id,price:e[o]._price,quantity:e[o]._quantity,shipping:r};t.items.push(n)}a.items=t.items,a.totalShipping=t.shippingTotal,a.carttax=(.075*i.getSubTotal()).toFixed(2)},t.randomShipping=function(){return 45*Math.random()+5},t.cartDetails()}]),commerceApp.controller("productController",["$scope","$location","$http","$log","$route","ngCart","$routeParams","shareService",function(t,e,o,r,n,i,a,c){t.department=c.cat,t.subcategory=c.subcat,t.getProducts=function(){o({method:"GET",url:"/products"}).then(function(e){t.products=e.data,t.buttonFilter()},function(t){r.error("getProducts error : "+t)})},t.buttonFilter=function(){for(var e=[],o=[],r=0;r<t.products.length;r++)o[r]=t.products[r].department,o=o.filter(function(t,e){return o.indexOf(t)==e});for(var n=0;n<o.length;n++){e[n]=[];for(var i=0;i<t.products.length;i++)t.products[i].department===o[n]&&(e[n].push(t.products[i].productAdjective),e[n]=e[n].filter(function(t,o){return e[n].indexOf(t)==o}))}t.categoriesInfo=o,t.subcategoriesInfo=e},t.resetFilter=function(){t.department="",c.cat="",t.subcategory="",c.subcat=""},t.setCategory=function(e){t.department=e,c.cat=e,t.subcategory="",c.subcat=""},t.setSubcategory=function(e,o){t.department=e,c.cat=e,t.subcategory=o,c.subcat=o},t.filterFunction=function(e){var o=!!e.department.match(t.department),r=!!e.productAdjective.match(t.subcategory);return!(!o||r!==!0)},t.getProducts()}]),commerceApp.controller("profileController",["$scope","$location","$http","$log","$route","shareService",function(t,e,o,r,n,i){t.shareService=i,t.showEdit=!1,t.profileEdit=function(){t.showEdit=!0},t.toProfile=function(){t.showEdit=!1},t.profileDelete=function(){var t=confirm("Are you sure you want to delete your account? This action can not be undone!");1==t&&o({method:"DELETE",url:"/profile"}).then(function(t){i.logout(),i.didLogout=!0,e.path("/")},function(t){r.error("failed to delete profile : "+t)})},t.getProfileInfo=function(){o({method:"GET",url:"/profile"}).then(function(e){t.profileData=e.data},function(t){r.error("profile fail : "+t)})},t.getProfileInfo()}]);